pipeline{
  agent any
  environment {

        imageName = "testnodeimage"
        registryCredentials = "nexus"
        registry = "192.168.33.10:8083"
        dockerImage = ''
         
    }
  stages {

  //   stage("npm install"){
  //     steps{

  //       echo 'Executing npm . . .'
  //       nodejs('Node-18.14.0'){
  //         sh 'npm install'

  //       }
  //     }
  //   }
  //    stage('SonarQube Analysis') {
  //     steps{
  //     script {
  //                   def scannerHome = tool 'scanner'
  //                   withSonarQubeEnv {
  //                       sh "${scannerHome}/bin/sonar-scanner"
  //                   }
  //               }

  //     }
    
  // }

//   stage('Initialize Docker') {
//     steps {
//         script {
//             def dockerHome = tool name: 'docker'
//             if (dockerHome) {
//                 env.PATH = "${dockerHome}/bin:${env.PATH}"
//                 echo dockerHome
//             } else {
//                 error "Docker tool not found. Please configure it in Jenkins."
//             }
//         }
//     }
// }
//  stage('Build and Run Docker') {
//             steps {
//                 script {
//                     docker.image('docker').inside {
//                         // Your Docker commands here
//                         sh 'docker build -t test .'
//                         sh 'docker run -p 8080:80 test'
//                     }
//                 }
//             }
//         }

    // Building Docker images
    stage('Building image') {
      steps{
        
        script {
         sh(f'docker build -t {registry}/node_app:3.0 .')
        }
      }
    }

    //  Uploading Docker images into Nexus Registry
    stage('Uploading image to Nexus') {
     steps{  
         script {
          
             docker.withRegistry("http://"+registry, registryCredentials ) {
            sh(f'docker push {registry}/node_app:3.0 ')
          }
        }
      }
    }

 stage("test"){
      steps{

        echo "Testingg . . ."
      }
    }
     stage("Deploy"){ 
      steps{

        echo "Deployingg. . ."
      }
    }
    
  }


}