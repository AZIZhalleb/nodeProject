pipeline{
  agent any
  environment {
        imageName = "mynodeapp"
        registryCredentials = "nexus"
        registry = "http://localhost:8081/repository/docker-hosted/"
        dockerImage = ''
    }
  stages {

    // stage("npm install"){
    //   steps{

    //     echo 'Executing npm . . .'
    //     nodejs('Node-18.14.0'){
    //       sh 'npm install'

    //     }
    //   }
    // }
  //    stage('SonarQube Analysis') {
  //     steps{
  //     script {
  //                   def scannerHome = tool 'scanner'
  //                   withSonarQubeEnv {
  //                       sh "${scannerHome}/bin/sonar-scanner"
  //                   }
  //               }

  //     }
    
  // }

//   stage('Initialize Docker') {
//     steps {
//         script {
//             def dockerHome = tool name: 'docker'
//             if (dockerHome) {
//                 env.PATH = "${dockerHome}/bin:${env.PATH}"
//                 echo dockerHome
//             } else {
//                 error "Docker tool not found. Please configure it in Jenkins."
//             }
//         }
//     }
// }

  stage('Build Docker Image with Kaniko') {
            steps {
                script {
           

                    // Set up Kaniko executor container
                    container('gcr.io/kaniko-project/executor:latest') {
                        // Nexus registry to push the image
                       

                        // Kaniko command to build and push the Docker image to Nexus
                        sh """
                            /kaniko/executor --context . --destination=${nexusRegistry}/${imageName}:${imageTag} --insecure --dockerconfig=/kaniko/.docker/config.json
                        """
                    }
                }
            }
        }

    // // Building Docker images
    // stage('Building image') {
    //   steps{
        
    //     script {
    //       dockerImage = docker.build imageName
    //     }
    //   }
    // }

    //   // Uploading Docker images into Nexus Registry
    // stage('Uploading to Nexus') {
    //  steps{  
    //      script {
    //          docker.withRegistry( 'http://'+registry, registryCredentials ) {
    //          dockerImage.push('latest')
    //       }
    //     }
    //   }
    // }

//  stage("test"){
//       steps{

//         echo "Testingg . . ."
//       }
//     }
//      stage("Deploy"){ 
//       steps{

//         echo "Deployingg. . ."
//       }
//     }
    
  }


}