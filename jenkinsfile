pipeline{
  agent any
  environment {

        imageName = "testnodeimage"
        registryCredentials = "nexus"
        registry = "192.168.33.10:8083"
        dockerImage = ''
         
    }
  stages {

 
  //    stage('SonarQube Analysis') {
  //     steps{
  //     script {
  //                   def scannerHome = tool 'scanner'
  //                   withSonarQubeEnv {
  //                       sh "${scannerHome}/bin/sonar-scanner"
  //                   }
  //               }

  //     }
    
  // }




    // Building Docker images
    stage('Building image (node and mongo)') {
      steps{
        
        script {
         sh('docker-compose build')
        }
      }
    }

    //  Uploading Docker images into Nexus Registry
    stage('Uploading image to Nexus') {
     steps{  
         script {
          
             docker.withRegistry("http://"+registry, registryCredentials ) {
            sh('docker-compose push $registry/nodemongoapp:4.0 ')
          }
        }
      }
    }

 stage("test"){
      steps{

        echo "Testingg . . ."
      }
    }
     stage("Deploy"){ 
      steps{

        echo "Deployingg. . ."
      }
    }
    
  }


}